/*! KeyTable 1.2.1
 * Â©2010-2014 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     KeyTable
 * @description Spreadsheet like keyboard navigation for DataTables
 * @version     1.2.1
 * @file        dataTables.keyTable.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2009-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
var KeyTable;!function(e,t,n){var o=function(o){"use strict";return KeyTable=function(a){function l(e){return function(t,n,o){if(null!==t&&"number"!=typeof t||null!==n&&"number"!=typeof n||"function"!=typeof o)if("object"==typeof t&&"function"==typeof n){var a=h(t);r(e,a[0],a[1],n)}else alert("Unhandable event type was added: x"+t+"  y:"+n+"  z:"+o);else r(e,t,n,o)}}function f(e){return function(t,n,o){if(null!==t&&"number"!=typeof arguments[0]||null!==n&&"number"!=typeof arguments[1])if("object"==typeof arguments[0]){var a=h(t);"function"==typeof arguments[1]?i(e,a[0],a[1],n):i(e,a[0],a[1])}else alert("Unhandable event type was removed: x"+t+"  y:"+n+"  z:"+o);else"function"==typeof arguments[2]?i(e,t,n,o):i(e,t,n)}}function r(e,t,n,o){B[e].push({x:t,y:n,fn:o})}function i(e,t,n,o){for(var a=0,l=0,f=B[e].length;f-a>l;l++)if("undefined"!=typeof o)B[e][l-a].x==t&&B[e][l-a].y==n&&B[e][l-a].fn==o&&(B[e].splice(l-a,1),a++);else if(B[e][l-a].x==t&&B[e][l-a].y==n)return B[e].splice(l,1),1;return a}function s(e,t,n){for(var o=0,a=B[e],l=0;l<a.length;l++)(a[l].x==t&&a[l].y==n||null===a[l].x&&a[l].y==n||a[l].x==t&&null===a[l].y||null===a[l].x&&null===a[l].y)&&(a[l].fn(m(t,n),t,n),o++);return o}function u(n,a){if(_!=n){"undefined"==typeof a&&(a=!0),null!==_&&d(_),o(n).addClass(j),o(n).parent().addClass(j);var l;if(P){l=P;for(var f=N(n)[1],r=w;f>=l.fnDisplayEnd();)l._iDisplayLength>=0?l._iDisplayStart+l._iDisplayLength<l.fnRecordsDisplay()&&(l._iDisplayStart+=l._iDisplayLength):l._iDisplayStart=0,P.oApi._fnCalculateEnd(l);for(;f<l._iDisplayStart;)l._iDisplayStart=l._iDisplayLength>=0?l._iDisplayStart-l._iDisplayLength:0,l._iDisplayStart<0&&(l._iDisplayStart=0),P.oApi._fnCalculateEnd(l);P.oApi._fnDraw(l),w=r}var i=h(n);_=n,C=i[0],K=i[1];var u,c,p,y,T,m,S;if(a&&(u=o(e).height(),c=o(e).width(),p=o(t).scrollTop(),y=o(t).scrollLeft(),T=n.offsetHeight,m=n.offsetWidth,S=D(n),!P||"undefined"==typeof l.oScroll||""===l.oScroll.sX&&""===l.oScroll.sY||(S[1]-=o(l.nTable.parentNode).scrollTop(),S[0]-=o(l.nTable.parentNode).scrollLeft()),S[1]+T>p+u?g(S[1]+T-u):S[1]<p&&g(S[1]),S[0]+m>y+c?v(S[0]+m-c):S[0]<y&&v(S[0])),P&&"undefined"!=typeof l.oScroll&&(""!==l.oScroll.sX||""!==l.oScroll.sY)){var x=l.nTable.parentNode;u=x.clientHeight,c=x.clientWidth,p=x.scrollTop,y=x.scrollLeft,T=n.offsetHeight,m=n.offsetWidth,n.offsetTop+T>u+p?x.scrollTop=n.offsetTop+T-u:n.offsetTop<p&&(x.scrollTop=n.offsetTop),n.offsetLeft+m>c+y?x.scrollLeft=n.offsetLeft+m-c:n.offsetLeft<y&&(x.scrollLeft=n.offsetLeft)}b(),s("focus",C,K)}}function c(){d(_),C=null,K=null,_=null,T()}function d(e){o(e).removeClass(j),o(e).parent().removeClass(j),s("blur",C,K)}function p(){for(var e=this;"TD"!=e.nodeName;)e=e.parentNode;u(e),b()}function y(e){if(E.block||!w)return!0;if(e.metaKey||e.altKey||e.ctrlKey)return!0;var t,n,o,a=k.getElementsByTagName("tr")[0].getElementsByTagName("td").length;if(P){o=P.aiDisplay.length;var l=N(_);if(null===l)return;C=l[0],K=l[1]}else o=k.getElementsByTagName("tr").length;var f=9==e.keyCode&&e.shiftKey?-1:e.keyCode;switch(f){case 13:return e.preventDefault(),e.stopPropagation(),s("action",C,K),!0;case 27:if(!s("esc",C,K))return void c();t=C,n=K;break;case-1:case 37:if(C>0)t=C-1,n=K;else{if(!(K>0))return-1==f&&x?(q=!0,L.focus(),setTimeout(function(){q=!1},0),w=!1,c(),!0):!1;t=a-1,n=K-1}break;case 38:if(!(K>0))return!1;t=C,n=K-1;break;case 36:t=C,n=0;break;case 33:t=C,n=K-10,0>n&&(n=0);break;case 9:case 39:if(a-1>C)t=C+1,n=K;else{if(!(o-1>K))return 9==f&&x?(q=!0,L.focus(),setTimeout(function(){q=!1},0),w=!1,c(),!0):!1;t=0,n=K+1}break;case 40:if(!(o-1>K))return!1;t=C,n=K+1;break;case 35:t=C,n=o-1;break;case 34:t=C,n=K+10,n>o-1&&(n=o-1);break;default:return!0}return u(m(t,n)),!1}function b(){w||(w=!0)}function T(){w=!1}function m(e,t){return P?"undefined"!=typeof P.aoData[P.aiDisplay[t]]?P.aoData[P.aiDisplay[t]].nTr.getElementsByTagName("td")[e]:null:o("tr:eq("+t+")>td:eq("+e+")",k)[0]}function h(e){return P?[o("td",e.parentNode).index(e),o("tr",e.parentNode.parentNode).index(e.parentNode)+P._iDisplayStart]:[o("td",e.parentNode).index(e),o("tr",e.parentNode.parentNode).index(e.parentNode)]}function g(e){t.documentElement.scrollTop=e,t.body.scrollTop=e}function v(e){t.documentElement.scrollLeft=e,t.body.scrollLeft=e}function D(e){var t=0,n=0;if(e.offsetParent)for(t=e.offsetLeft,n=e.offsetTop,e=e.offsetParent;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return[t,n]}function N(e){for(var t=0,n=P.aiDisplay.length;n>t;t++)for(var o=P.aoData[P.aiDisplay[t]].nTr,a=o.getElementsByTagName("td"),l=0,f=a.length;f>l;l++)if(a[l]==e)return[l,t];return null}function S(e,n,a,l){if(E=l,"undefined"==typeof a&&(a={}),"undefined"==typeof a.focus&&(a.focus=[0,0]),a.table=e,o(a.table).addClass("KeyTable"),"undefined"!=typeof a.focusClass&&(j=a.focusClass),"undefined"!=typeof n&&(P=n),"undefined"==typeof a.initScroll&&(a.initScroll=!0),"undefined"==typeof a.form&&(a.form=!1),x=a.form,k=a.table.getElementsByTagName("tbody")[0],x){var f=t.createElement("div");L=t.createElement("input"),f.style.height="1px",f.style.width="0px",f.style.overflow="hidden","undefined"!=typeof a.tabIndex&&(L.tabIndex=a.tabIndex),f.appendChild(L),a.table.parentNode.insertBefore(f,a.table.nextSibling),o(L).focus(function(){q||(w=!0,q=!1,"undefined"!=typeof a.focus.nodeName?u(a.focus,a.initScroll):u(m(a.focus[0],a.focus[1]),a.initScroll),setTimeout(function(){L.blur()},0))}),w=!1}else"undefined"!=typeof a.focus.nodeName?u(a.focus,a.initScroll):u(m(a.focus[0],a.focus[1]),a.initScroll),b();o(t).bind("keydown",y),P?o(P.nTable).on("click","td",p):o(k).on("click","td",p),o(t).click(function(e){for(var t=e.target,n=!1;t;){if(t==a.table){n=!0;break}t=t.parentNode}n||c()})}this.block=!1,this.event={remove:{}},this.fnGetCurrentPosition=function(){return[C,K]},this.fnGetCurrentData=function(){return _.innerHTML},this.fnGetCurrentTD=function(){return _},this.fnSetPosition=function(e,t){u("object"==typeof e&&e.nodeName?e:m(e,t))},this.fnBlur=function(){c()};var x,L,k=null,_=null,C=null,K=null,E=null,j="focus",w=!1,B={action:[],esc:[],focus:[],blur:[]},P=null,q=!1;for(var A in B)A&&(this.event[A]=l(A),this.event.remove[A]=f(A));var H,Q;a===n?(H=o("table.KeyTable")[0],Q=null):o.isPlainObject(a)?(H=a.table,Q=a.datatable):(Q=new o.fn.dataTable.Api(a).settings()[0],H=Q.nTable),S(H,Q,a,this)},KeyTable.version="1.2.1",o.fn.dataTable.KeyTable=KeyTable,o.fn.DataTable.KeyTable=KeyTable,KeyTable};"function"==typeof define&&define.amd?define(["jquery","datatables"],o):"object"==typeof exports?o(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.KeyTable&&o(jQuery,jQuery.fn.dataTable)}(window,document);